# "Попутного ветра" - сервис планирования сложных маршрутов
## Авторы
* Гасилин Максим, победитель хакатона по анализу данных от МТС и НИУ ВШЭ ***"Рекламатон"*** 2025 (НИУ ВШЭ, 2 курс, ВШБ, Бизнес-информатика)
* Исхаков Булат, стратег-аналитик VK (ex-Азбука вкуса), победитель кейс-чемпионатов ***VK x HSE Case Champ 2024, Cup IT 2024*** (НИУ ВШЭ, 2 курс, ВШБ, Управление цепями поставок)
* Шалашов Дмитрий, победитель хакатона по анализу данных от МТС и НИУ ВШЭ ***"Рекламатон"*** 2025 (НИУ ВШЭ, 2 курс, ВШБ, Бизнес-информатика)
* Ярославский Ян, победитель кейс-чемпионата ***VK x HSE Case Champ 2024***, финалист чемпионата по анализу данных ***DANO 2023*** (НИУ ВШЭ, 1 курс, ВШБ, Бизнес-информатика)

## Структура репозитория, рекомендации по установке и работе с сервисом:
1. Клиентская часть
   Клиентская часть (веб-сервис) расположена в папке client. Для ее запуска необходимо установить все содержимое папки с запустить файл .
   
   ***Важно!*** При работе с сервисом при прогнозировании маршрутов важно не просто вводить название города, а выбирать его из списка предложенных.

 2. **Серверная часть**

    В папке ***server*** находится серверная часть проекта. Она состоит из файла ***"main.py"***, запуск которого и необходим для старта сервера, папки с контроллерами (папка ***"controllers"***), которые отвечают за обработку запросов от сервера, папки ***"services"*** с сервисными утилитами (сервисом по работе с геолокациями и сервисом для работы с построением маршрутов) и папки ***"static"***, в которой хранится предпросчитанная информация о станциях и маршрутах между основными транспортными узлами городов Москва и Санкт-Петербург.

    При установке серверной части необходимо загрузить все содержимое папки ***server***, удостовериться, что  все необходимые библиотеки установлены, и запустить файл ***main.py***. Сервер будет запускаться по адресу ***127.0.0.1:5000***, куда можно обращаться не только через клиентскую часть, но и через сторонние утилиты.

## Описание проекта
> ***При планировании путешествий в топ трудностей пользователей входит ограниченный круг возможных типов перемещения, кроме того на рынке сейчас нет продуктов, которые позволили бы полностью построить путешествие из пункта А в пункт Б, если там есть разные типы транспорта: «Попутного ветра» — это сервис, которые решает эту проблему и подбирает пользователю несколько оптимальных маршрутов по его предпочтениям***

### Функционал сервиса
1. **Составление маршрутов по начальному, конечному и промежуточному пунктам**
   - Составление маршрутов с учетом пересадки в выбранном городе
     - Ранжирование предлагаемых маршрутов
2. **Предоставление возможности рассмотрения подробной логистики пересадок**
   - Автоматический учет минимального времени пересадок при сопоставлении маршрутов 
     - Построение маршрутов пересадок внутри крупных городов
3. **Ранжирование предлагаемых маршрутов**
   - Предоставление возможности сортировки маршрутов по времени отправления, времени прибытия, времени в пути и общей стоимости
   - Ранжирование маршрутов с использованием моделей машинного обучения
     - Модификация критериев ранжирования под каждого пользователя

### Техническая сторона сервиса

Составление маршрутов производится при помощи информации, полученной от сервиса Яндекс.Расписание - именно с помощью данного сервиса определяются промежуточные пункты и рассчитываются потенциальные маршруты. Описание устройства отдельных частей сервиса:

#### 1. Алгоритм учета времени пересадок

* **Учет времени регистрации и выхода в город с расчетом на специфику различных видов транспорта**

  При пересадках с одного вида транспорта на другой, помимо времени, необходимого на то, чтобы добраться с одной станции на другую, учитывается также и время, необходимое на прохождение регистрации, поиск нужного рейса и прочего. Аналогично и при прибытии - учитывается время на выход из вокзала, получение багажа и так далее.
* **Построение маршрутов для пересадки внутри крупных городов**

  При пересадках в Москве и Санкт-Петербурге не только оценивается время, необходимое на саму пересадку, но и проводится расчет маршрутов между станциями с использованием 2ГИС API.Данные маршруты доступны пользователям для просмотра и позволяют оценивать, каким образом необходимо 

#### 2. Система ранжирования поездок

* **Использование метода k-means для разбиения клиентской базы на сегменты**

  Для более точного ранжирования маршрутов среди новых пользователей, клиентская база была разбита на кластеры с помощью ***k средних***, используя информацию о маршрутах, выбранных ими. За счет данного метода впоследствии были получены веса, использующиеся в качестве базовых весов ранжирования для пользователей, впервые зашедших на сайт, для которых не были составлены персонализированные критерии

* **Ранжирование маршрутов используя метод LambdaMART**

  Для ранжирования маршрутов, построенных зарегистрированных пользователей, в системе уже хранятся веса, в то время как для новых или незарегистрированных пользователей используяся веса, полученные в результате использования метода LambdaMART на кластере пользователей.

* **Персонализация критериев ранжирования**

  Использованная модель дополнительно обучается на основании каждого нового выбора пользователя, изменяя веса для ранжирования с целью более точно соответствовать предпочтениям клиента

## Технические ограничения на проект и перспективы развития

1. **Нехватка ключевой информации**
   - **Нехватка данных о стыковочных рейчас**

      Вследствие нехватки о стыковках между полетами, все рейсы были учтены как пересадки, а не как стыковки. Данное ограничение не является существенным, поскольку влияет на возможное время пересадки, однако не имеет весомого веса на работоспособности проекта 

   - **Отсутвие информации о выбранных пользователями маршрутах**
  
      Отсутствие подобных данных значительно усложняет как процесс создания алгоритмов ранжирования маршрутов, так и процесс персонализации критериев ранжирования. Для решения данной проблемы был создан синтетический датасетЮ содержащий информацию о выборах потребителей. На его основании были определены веса для ранжирования маршрутов, однако при появлении реальных данных необходимо будет провести обучение модели заново

2. **Ограничения на доступ к данным**
   - **Органиченный доступ к API сервиса 2ГИС**

       Ограничение на сервис 2ГИС, а также и на другие сервисы по построению маршрутов имеют значительные последствия на функционале программы, поскольку снижают ее производительность и лишают возможности строить маршруты для каждой пересадки заранее, в связи с чем был проведен предварительный просчет маршрутов между ключевыми точками Москвы и Санкт-Петербурга. При создании полноценноо сервиса данное ограничение будет обходиться наличием полноценного доступа, что позволит с большей точностью оценивать время пересадок между станциями внутри города и расширить список городов, для которых просчитывается внутренняя логистика, до большего количества.

   - **Низкая производительность API Яндекс расписания**
  
     Ввиду низкой производительности функционала API Яндекс расписания *(вплоть до 5 секунд ожидания ответа на запрос)*, существенно замедлена производительность сервиса, а также органичен функционал определения промежуточных пунктов пересадок. Так, в системе на данный момент определение промежуточных городов осуществляется через поиск таковых функционалом самого сервиса Яндекс расписание, в то время как при создании полноценного сервиса данный недостаток будет исключен за счет самостоятельного поиска пересадочных пунктов через ***обход графа городов в ширину***

   - **Несостыковка геоданных в системах 2ГИС и Яндекс.Расписание**
  
     Из-за неточностей при определении объектов по геолокации возникают дефекты, связанные с работой со станциями при построении маршрутов внутри Москвы и Санкт-Петербурга. Таким образом, станции, отмеченные при построении маршрута через 2ГИС и возвращенные как координаты, при попытке определения станций из Яндекс.Расписания могут возвращать неверные данные ввиду близости нескольких станций друг к другу
